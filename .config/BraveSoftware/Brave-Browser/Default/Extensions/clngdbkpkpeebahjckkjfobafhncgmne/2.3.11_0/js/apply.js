if(1!==self["apply.js"]){self["apply.js"]=1;const e=this,t=e.document;(()=>{const n={get:({name:e},t)=>new Proxy(Object.defineProperty(()=>{},"name",{value:e?e+"."+t:t}),n),apply:async function({name:e},t,n){const o=new Error,i={data:{method:"invokeAPI",path:e,args:n},TDM:s};for(let e,t,n=0;n<2;n++){try{if(e=await chrome.runtime.sendMessage(i),e){if(c=r=null,t=e.error)throw t.stack+="\n"+o.stack,t;return e.data}}catch(e){if(!c)throw e.stack=o.stack,e}if(n)throw new Error("Stylus could not connect to the background script.");await c}}},o=e.API=new Proxy({path:""},n),i=window!==top;let r,c=!1,s=i?0:t.prerendering?-1:1;function a(e){s=e}const f=new Map,l=e=>({data:e}),d=e=>({error:Object.assign({message:e.message||`${e}`,stack:e.stack},e)});function u(e,t,n){let o,i,r=0;n&&(e=(n=e)[0]);do{for(const[r,c]of f){try{i=r(e,t,!!n)}catch(e){i=Promise.reject(e)}c&&i!==o&&void 0===o&&(o=i)}}while(n&&(e=n[++r]));return o}chrome.runtime.onMessage.addListener(function({data:e,multi:t,TDM:n},o,i){0;0;o.TDM=n;let r=!1;if(r=r?r.then(u.bind(null,e,o,t)):u(e,o,t),r instanceof Promise)return r.then(l,d).then(i),!0;void 0!==r&&i(l(r))});const g=!1,m="stylus",p=m+"-",h="screen, "+p,y="adoptedStyleSheets",w={cfg:{off:!1,top:""}},b=chrome.runtime,v=b.id,S=t instanceof XMLDocument,k=t,E=new Set(["head","body","frameset","style","link"]),L=function(e){let n,o=!1;const i=new MutationObserver(e);return{start:function(){if(o||C)return;z=t.documentElement,n=setTimeout(e),i.observe(t,{childList:!0}),o=!0},stop:function(){if(!o)return;clearTimeout(n),i.disconnect(),o=!1}}}(me),x=function(e){let t=!1;const n=new MutationObserver(e);return{start:o,stop:i,restart:function(){t&&(i(),o())}};function o(){t||C||(n.observe(z,{childList:!0}),t=!0)}function i(){t&&(n.disconnect(),t=!1)}}(ue),M=e=>String.fromCharCode(65280+e.charCodeAt(0)-32),O=[],j={},T=({id:e})=>1e6*J[e]||q[e]||e+5e5,A=(e,t)=>T(e)-T(t),P=new Map;let C,U,D,$,R,B,I,N,G,J,q,V,X,z=t.documentElement,F=!0,H="",K=0,Q=0;function W(e){de(P.get(e))&&ae()}function Y(e){F!==(e=!!e)&&(F=e,e?_():te())}function Z(e,t){if(C){const n=U||k[y].slice();let o=D(n,e);o>=0&&(e=n.splice(o,1)[0]),o=t?D(n,t):-1,o>=0?n.splice(o,0,e):n.push(e),U||(k[y]=n)}else me().insertBefore(e,t);return e}function _(){O.length&&(se(!1),C?ne(!0):me().append(...O.map(e=>e.el)),se(!0))}function ee(e){if(e.remove)e.remove();else if(C){const t=U||k[y].slice(),n=D(t,e);n>=0&&(t.splice(n,1),U||(k[y]=t))}}function te(){if(se(!1),C)ne();else for(const{el:e}of O)ee(e)}function ne(e){const t=O.map(e=>e.el),n=[];for(let e,o=U||k[y],i=0;i<o.length&&(e=o[i]);i++)D(t,e)<0&&n.push(e);e&&n.push(...t),k[y]=n}function oe({cfg:e,sections:t},n){e&&ge(e);const o=n&&new Set;for(const e of t){const{id:t,code:i}=e,r=Array.isArray(i)?e.code=i.join(""):i,c=P.get(t);if(c)(c.code!==r||R&&c.name!==e.name)&&(c.code=r,ce(c.el,e),c.el.disabled=!1);else{e.el=re(e),P.set(t,e);const n=O.findIndex(t=>T(t)>T(e));O.splice(n<0?O.length:n,0,e)}n&&o.add(t)}if(se(!1),n&&O.length>o.size)for(let e,t=O.length;--t>=0;)o.has((e=O[t]).id)||de(e);F&&($||ie(t),ue()),ae()}function ie(e){if($=!0,"complete"===t.readyState||"hidden"===t.visibilityState||!e.some(e=>e.code.includes("transition")))return;const n=re({id:"transition-patch",code:":not(#\\0):not(#\\0) { transition: none !important }"});Z(n),requestAnimationFrame(()=>setTimeout(ee,0,n))}function re(e){let t,{id:n}=e;if(C){R||(n=j[n]??=performance.now().toString(36)),n=h+n,t=new CSSStyleSheet({media:n}),ce(t,e);for(let e,t=U||k[y],o=0;o<t.length;o++)(e=t[o].media).mediaText===n&&(e.mediaText+="-old");return t}return!I&&(t=le(e))||(t=z instanceof SVGSVGElement?G("http://www.w3.org/2000/svg","style"):S?G("http://www.w3.org/1999/xhtml","style"):N("style"),H&&(t.nonce=H),n&&R&&(n=t.id=`${p}${n}`),t.classList.add(m),ce(t,e)),t}function ce(e,{id:t,code:n,name:o}){if(C)try{e.replaceSync(n)}catch{e.replace(n)}else R&&o&&(e.dataset.name!==o&&(e.dataset.name=o),o=encodeURIComponent(o.replace(/[?#/']/g,M)),n+=`\n/*# sourceURL=${b.getURL(o)}.user.css#${t}${window!==top?"#"+Math.random().toString(36).slice(2):""} */`),(e.firstChild||e).textContent=n}function se(e){if(C&&e)return;const t=e&&F?"start":"stop";L[t](),x[t]()}function ae(){se(O.length),V()}function fe(){D||(Object.isExtensible(C)&&(U=C),D=Object.call.bind([].indexOf))}function le(e){I=k;for(let e,t=0;!e&&t<2;t++)return N=I.createElement.bind(I),void(G=I.createElementNS.bind(I))}function de(e){if(e)return P.delete(e.id),O.splice(O.indexOf(e),1),ee(e.el),!0}function ue(e){if(!b.id)return X();let t,n=O.length&&O[0].el;if(n)if(C){U||(C=k[y]);for(let e=O.length,n=C.length-e,o=0;o<e;o++)if(n<0||C[n+o]!==O[o].el){t=!0;break}}else if(n.parentNode!==I.documentElement)t=!0;else{let e=0;for(;n;){if(e<O.length&&n===O[e].el)e++;else if(E.has(n.localName)){t=!0;break}n=n.nextElementSibling}e<O.length&&(t=!0)}else t=!1;if(!t)return;!e||++K<10?_():console.debug("Stylus ignored wrong order of styles to avoid an infinite loop of mutations.");const o=performance.now();o-Q>250&&(K=0,Q=o)}function ge(e){if(R=e.name,H=e.nonce||H,B=!H&&g,({main:q={},prio:J={}}=e.order||{}),!C!=!e.ass){te(),C=C?null:k[y],C&&fe();for(const e of O)e.el=re(e);_()}}function me(){return b.id?(z!==t.documentElement&&(z=t.documentElement,_(),x.restart()),z):X()}const pe="styles",he="pageshow",ye=e=>"object"==typeof e&&e?JSON.parse(JSON.stringify(e)):e;let we=!1;if(i)try{we=Object.getOwnPropertyDescriptor(parent.location,"href"),we=!!we?.get}catch{}const be=we&&"about:"===location.protocol,ve=`${Math.random()}`,Se="url:"+b.id,ke=e[Se]=new EventTarget,Ee=be&&parent[Se]||null,Le=!i&&matchMedia("(prefers-color-scheme: dark)");let xe,Me,Oe,je,Te,Ae=be?parent.location.href.split("#")[0]:location.href,Pe=i;async function Ce(){let e;if(e=be&&ye(parent[parent.Symbol.for(pe)]),e?await new Promise(Ve):e=!we&&!S&&De(),!b.id)return Qe();await Ue(e,!0)}async function Ue(t,n=!w.sections){t||(t=await o.styles.getSectionsByUrl(Ae,null,n)),t.cfg||(t.cfg=w.cfg),Object.assign(w,e[Symbol.for(pe)]=t),i||""!==w.cfg.top||(w.cfg.top=location.origin),i||w.cfg.dark===Le.matches||Le.onchange(Le),O.length?oe(w,!0):w.cfg.off||oe(w),Y(!w.cfg.off)}function De(){try{const e=(t.cookie.split(v+"=")[1]||"").split(";")[0];if(!e)return;const n="blob:"+b.getURL(e);t.cookie=`${v}=1; max-age=0; SameSite=Lax`;const o=new XMLHttpRequest;return o.open("GET",n,!1),o.send(),JSON.parse(o.response)}catch{}}function $e(e,t,n){if(n)return Oe??=Promise.resolve().then(Re)&&[],void Oe.push(e);const{style:i}=e;switch(e.method){case"ping":return!0;case"styleDeleted":W(i.id);break;case"styleUpdated":if(!w.sections&&w.cfg.off)break;i.enabled?o.styles.getSectionsByUrl(Ae,i.id).then(e=>e.sections.length?oe(e):W(i.id)):W(i.id);break;case"styleAdded":!w.sections&&w.cfg.off||!i.enabled||o.styles.getSectionsByUrl(Ae,i.id).then(oe);break;case"urlChanged":Ae===e.old&&qe(e.url);break;case"injectorConfig":Be(e);break;case"backgroundReady":return w.sections&&Ge(),!0}}function Re(){for(const e of Oe)$e(e);Oe=null,Ge()}function Be({cfg:e}){for(const t in e){const n=e[t];n!==w.cfg[t]&&(("top"!==t||i)&&(w.cfg[t]=n,"off"===t?Ie():"order"===t?(O.sort(A),F&&_()):"top"===t?Ne():"wake"===t?Je():ge(w.cfg)))}}function Ie(){w.sections||w.cfg.off?Y(!w.cfg.off):xe||Ce()}function Ne(){const e="stylus-iframe",n=t.documentElement;n&&(w.cfg.top&&O.length?n.getAttribute(e)!==w.cfg.top&&n.setAttribute(e,w.cfg.top):n.hasAttribute(e)&&n.removeAttribute(e))}function Ge(){let e,t;s<0||(i&&Pe&&performance.now()>1e3&&(Pe=!1),Oe||je===(t=(e=[...P.keys()]).join(","))||(o.updateIconBadge(e,Pe),je=t))}function Je(){w.cfg.wake||O.length?Me||!i&&!w.cfg.wake||(Me=b.connect({name:"apply"}),Me.onDisconnect.addListener(Fe)):(Me?.disconnect(),Me=null)}function qe(e){e!==Ae&&(Ae=e,w.sections&&Ue(w.cfg.off&&{}),ke.dispatchEvent(new Event(Se)))}function Ve(e){parent[parent.Symbol.for("xo")](frameElement,e),(xe??=[]).push(e)}function Xe(e){if(!b.id)return Qe();for(const t of e)t.intersectionRatio&&(Te.unobserve(t.target),t.target.dispatchEvent(new Event(ve)))}function ze(e){if(!b.id)return Qe();e.isTrusted&&e.persisted&&(je="",Ce())}function Fe(){w.cfg.wake&&addEventListener("mousedown",He,!0),Me=null}function He(e){if(!b.id)return Qe();!Me&&e.target.closest("a")?.href&&Je()}function Ke(){qe(parent.location.href)}function Qe(){if(removeEventListener(he,ze),Le&&(Le.onchange=null),xe)for(const e of xe)e();s<0&&(t.onprerenderingchange=null),removeEventListener("mousedown",He,!0),Ee?.removeEventListener(Se,Ke,!0),xe=null,O.length&&(se(!1),te(),O.length=0,P.clear()),f.delete($e),Me?.disconnect()}e[Symbol.for("xo")]=(e,t)=>{Te||(Te=new IntersectionObserver(Xe,{rootMargin:"100%"})),e.addEventListener(ve,t,{once:!0}),Te.observe(e)},Ee?.addEventListener(Se,Ke,!0),Le&&(Le.onchange=({matches:e})=>{e!==w.cfg.dark&&o.setSystemDark(w.cfg.dark=e)}),s<0&&(t.onprerenderingchange=function(e){if(!b.id)return Qe();e.isTrusted&&(a(2),t.onprerenderingchange=null,o.styles.getSectionsByUrl("",0,"cfg").then(Be),Ge())}),V=()=>{Ge(),i&&Ne(),(i||w.cfg.wake)&&Je()},X=Qe,Ce(),f.set($e,!0),addEventListener(he,ze)})()}